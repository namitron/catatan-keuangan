<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catatan Keuangan</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Catatan Keuangan</h1>
        
        <form id="form">
            <input type="text" id="description" placeholder="Deskripsi" required>
            <input type="number" id="amount" placeholder="Jumlah" required>
            <select id="type">
                <option value="income">Pemasukan</option>
                <option value="expense">Pengeluaran</option>
            </select>
            <button type="submit">Tambah</button>
        </form>

        <table>
            <thead>
                <tr>
                    <th>Deskripsi</th>
                    <th>Jumlah</th>
                    <th>Tipe</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="transaction-table">
            </tbody>
        </table>

        <div class="summary">
            <h2>Ringkasan</h2>
            <p>Pemasukan: <span id="income-total">Rp 0</span></p>
            <p>Pengeluaran: <span id="expense-total">Rp 0</span></p>
            <p>Saldo: <span id="balance">Rp 0</span></p>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script type="module">
      // Import Firebase SDK
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
      import { getDatabase, ref, set, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCThcGVbqaOSvDhWARk0-4Icqxt95vuVgY",
        authDomain: "catatan-67be8.firebaseapp.com",
        projectId: "catatan-67be8",
        storageBucket: "catatan-67be8.appspot.com",
        messagingSenderId: "481382304833",
        appId: "1:481382304833:web:4004daa9d8d4daed440ac0"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);

      // DOM Elements
      const form = document.getElementById('form');
      const transactionTable = document.getElementById('transaction-table');
      const incomeTotalDisplay = document.getElementById('income-total');
      const expenseTotalDisplay = document.getElementById('expense-total');
      const balanceDisplay = document.getElementById('balance');

      let transactions = [];

      // Listen for transactions in Firebase
      onValue(ref(database, 'transactions'), (snapshot) => {
          const data = snapshot.val();
          transactions = [];
          transactionTable.innerHTML = '';

          for (let key in data) {
              const transaction = data[key];
              transactions.push({ ...transaction, id: key });
              displayTransaction({ ...transaction, id: key });
          }

          updateSummary();
      });

      // Add new transaction
      form.addEventListener('submit', function(e) {
          e.preventDefault();

          const description = document.getElementById('description').value;
          const amount = parseFloat(document.getElementById('amount').value);
          const type = document.getElementById('type').value;

          if (description === '' || isNaN(amount)) {
              alert('Silakan masukkan deskripsi dan jumlah yang valid.');
              return;
          }

          const transaction = {
              description,
              amount,
              type
          };

          // Push transaction to Firebase
          push(ref(database, 'transactions'), transaction);

          form.reset();
      });

      // Display transaction in table
      function displayTransaction(transaction) {
          const row = document.createElement('tr');
          row.innerHTML = `
              <td>${transaction.description}</td>
              <td>Rp ${transaction.amount}</td>
              <td>${transaction.type === 'income' ? 'Pemasukan' : 'Pengeluaran'}</td>
              <td><button onclick="removeTransaction('${transaction.id}')">Hapus</button></td>
          `;
          transactionTable.appendChild(row);
      }

      // Remove transaction from Firebase
      window.removeTransaction = function(id) {
          remove(ref(database, 'transactions/' + id));
      }

      // Update income, expense, and balance
      function updateSummary() {
          const incomeTotal = transactions
              .filter(transaction => transaction.type === 'income')
              .reduce((acc, transaction) => acc + transaction.amount, 0);

          const expenseTotal = transactions
              .filter(transaction => transaction.type === 'expense')
              .reduce((acc, transaction) => acc + transaction.amount, 0);

          const balance = incomeTotal - expenseTotal;

          incomeTotalDisplay.textContent = `Rp ${incomeTotal}`;
          expenseTotalDisplay.textContent = `Rp ${expenseTotal}`;
          balanceDisplay.textContent = `Rp ${balance}`;
      }
    </script>
</body>
</html>
