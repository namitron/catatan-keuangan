// Update the transaction table and chart
function updateTable() {
    transactionTable.innerHTML = ''; // Kosongkan tabel sebelum ditampilkan
    const year = document.getElementById('year').value;
    const month = document.getElementById('month').value;
    const week = document.getElementById('week').value;

    let incomeTotal = 0;
    let expenseTotal = 0;
    let dailyIncome = {};
    let dailyExpense = {};
    let dailyBalance = {};

    const startDate = new Date(year, month - 1, (week - 1) * 7 + 1);
    const endDate = new Date(year, month - 1, week * 7);

    transactions.forEach(transaction => {
        const transactionDate = new Date(transaction.time);
        if (transactionDate >= startDate && transactionDate <= endDate) {
            const row = transactionTable.insertRow();
            const descriptionCell = row.insertCell(0);
            const amountCell = row.insertCell(1);
            const typeCell = row.insertCell(2);
            const timeCell = row.insertCell(3);
            const balanceCell = row.insertCell(4);
            const actionCell = row.insertCell(5);

            descriptionCell.textContent = transaction.description;
            amountCell.textContent = `Rp ${transaction.amount}`;
            typeCell.textContent = transaction.type;
            timeCell.textContent = transactionDate.toLocaleString();
            balanceCell.textContent = `Rp ${transaction.balance}`;

            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Hapus';
            deleteButton.classList.add('delete-button');
            deleteButton.onclick = () => {
                remove(ref(database, 'transactions/' + transaction.id));
            };
            actionCell.appendChild(deleteButton);

            // Hitung total pemasukan dan pengeluaran per hari
            const dateKey = transactionDate.toLocaleDateString(); // Kunci untuk menyimpan data harian
            if (transaction.type === 'income') {
                incomeTotal += transaction.amount;
                dailyIncome[dateKey] = (dailyIncome[dateKey] || 0) + transaction.amount;
            } else {
                expenseTotal += transaction.amount;
                dailyExpense[dateKey] = (dailyExpense[dateKey] || 0) + transaction.amount;
            }
        }
    });

    // Update ringkasan
    incomeTotalDisplay.textContent = `Rp ${incomeTotal}`;
    expenseTotalDisplay.textContent = `Rp ${expenseTotal}`;
    const balance = incomeTotal - expenseTotal;
    balanceDisplay.textContent = `Rp ${balance}`;

    // Update grafik
    updateChart(dailyIncome, dailyExpense, balance);
}

// Update the chart based on totals
function updateChart(dailyIncome, dailyExpense, totalBalance) {
    labels.length = 0; // Kosongkan label grafik
    incomeData.length = 0; // Kosongkan data pemasukan
    expenseData.length = 0; // Kosongkan data pengeluaran
    balanceData.length = 0; // Kosongkan data saldo

    // Tambahkan data harian ke grafik
    for (const date in dailyIncome) {
        labels.push(date);
        incomeData.push(dailyIncome[date]);
        expenseData.push(dailyExpense[date] || 0); // Jika tidak ada pengeluaran, set 0
        balanceData.push(totalBalance); // Gunakan total saldo yang ada
    }

    myChart.update(); // Perbarui grafik
}
